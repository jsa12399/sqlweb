{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>SportFit</title>
    {# Solo necesitas un {% load static %} al principio del archivo #}
    <link rel="stylesheet" href="{% static 'core/css/style.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <header>
        <nav>
            <ul class="menu">
                <li><a href="{% url 'index' %}">Inicio</a></li>
                <li class="submenu">
                    <a href="#">Servicios</a>
                    <ul>
                        <li><a href="{% url 'nutricionista' %}">Nutricionista</a></li>
                        <li><a href="{% url 'preparadorfisico' %}">Preparador f칤sico</a></li>
                    </ul>
                </li>
                <li><a href="{% url 'productos' %}">Productos</a></li>
                
                {# AQUI ES DONDE A칌ADIREMOS EL ENLACE AL CARRITO #}
                <li class="nav-item-carrito"> {# Puedes usar una clase para estilos espec칤ficos #}
                    <a href="{% url 'carrito' %}" class="carrito-link">
                        游 Carrito <span id="carrito-contador">(0)</span>
                    </a>
                </li>

                {% if user.is_authenticated %}
                    {# Si tienes l칩gica para roles, puedes a침adirla aqu칤 dentro del li #}
                    {# Por ejemplo, si usas los test que definiste en views.py, podr칤as hacer esto (requiere un custom tag o filtro) #}
                    {# {% if user|is_nutricionista %} #}
                    {#     <li><a href="{% url 'panel_nutricionista' %}">Panel Nutricionista</a></li> #}
                    {# {% endif %} #}
                    <li><a href="{% url 'logout' %}">Cerrar sesi칩n ({{ user.email }})</a></li>
                {% else %}
                    <li><a href="{% url 'login' %}">Iniciar sesi칩n</a></li>
                    <li><a href="{% url 'register' %}">Registrarse</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>

    {% block content %}{% endblock %}

    {# SCRIPT PARA EL CONTADOR DEL CARRITO - Col칩calo antes de </body> para que el DOM est칠 cargado #}
    <script>
        function getCarritoCount() {
            const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
            let totalItems = 0;
            carrito.forEach(item => {
                totalItems += item.cantidad;
            });
            return totalItems;
        }

        function updateCarritoCounter() {
            const contadorElement = document.getElementById('carrito-contador');
            if (contadorElement) {
                contadorElement.textContent = `(${getCarritoCount()})`;
            }
        }

        // Se ejecuta cuando el DOM est치 completamente cargado
        document.addEventListener('DOMContentLoaded', updateCarritoCounter);

        // Opcional: Si los productos se a침aden a la p치gina de productos (productos.html) y quieres
        // que el contador en el navbar (base.html) se actualice sin recargar la p치gina,
        // puedes despachar un evento personalizado desde productos.html
        // y escucharlo aqu칤.
        // Ejemplo en productos.html despu칠s de localStorage.setItem:
        // window.dispatchEvent(new Event('carritoActualizado'));
        // Y aqu칤 en base.html:
        // window.addEventListener('carritoActualizado', updateCarritoCounter);
        // Para tu configuraci칩n actual con localStorage, esto no es estrictamente necesario
        // porque el contador se actualizar치 cada vez que se carga una nueva p치gina.
    </script>
</body>
</html>